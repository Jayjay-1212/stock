<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì½”ìŠ¤ë‹¥ ì„¸ë ¥ ë§¤ì§‘ ë¦¬í¬íŠ¸ {{ scan_date }}</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
         background: #f0f2f5; color: #333; padding: 20px; }
  .container { max-width: 1400px; margin: 0 auto; }

  /* í—¤ë” */
  .header { background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white; padding: 24px 30px; border-radius: 12px; margin-bottom: 20px; }
  .header h1 { font-size: 24px; margin-bottom: 6px; }
  .header .meta { font-size: 13px; opacity: 0.8; }

  /* ìš”ì•½ ì¹´ë“œ */
  .summary { display: flex; gap: 16px; margin-bottom: 20px; }
  .card { background: white; border-radius: 10px; padding: 16px 20px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.08); flex: 1; text-align: center; }
  .card .num { font-size: 28px; font-weight: bold; color: #2a5298; }
  .card .label { font-size: 12px; color: #888; margin-top: 4px; }

  /* í…Œì´ë¸” */
  .table-wrap { background: white; border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow: hidden; margin-bottom: 24px; }
  table { width: 100%; border-collapse: collapse; }
  thead th { background: #1e3c72; color: white; padding: 12px 14px;
             text-align: center; font-size: 12px; font-weight: 600; }
  tbody td { padding: 10px 14px; border-bottom: 1px solid #f0f0f0;
             font-size: 13px; text-align: center; }
  tbody tr:hover { background: #f8f9ff; }
  tbody tr:last-child td { border-bottom: none; }

  /* ì ìˆ˜ */
  .score-high { color: #e74c3c; font-weight: bold; font-size: 15px; }
  .score-mid  { color: #e67e22; font-weight: bold; }
  .score-low  { color: #27ae60; font-weight: bold; }

  /* ì„¹í„° ë°°ì§€ */
  .badge { display: inline-block; padding: 2px 10px; border-radius: 20px;
           font-size: 11px; font-weight: 600; }
  .badge-bio  { background: #fde8e8; color: #c0392b; }
  .badge-robot { background: #e8f4fd; color: #2980b9; }
  .badge-ai   { background: #eafaf1; color: #27ae60; }
  .badge-bat  { background: #fef9e7; color: #d4ac0d; }
  .badge-etc  { background: #f2f3f4; color: #7f8c8d; }

  /* ì‹ í˜¸ ì ìˆ˜ ë°” */
  .sig-bar { display: flex; align-items: center; gap: 4px; font-size: 11px; }
  .sig-bar-fill { height: 6px; background: #3498db; border-radius: 3px; }

  /* ì°¨íŠ¸ ì„¹ì…˜ */
  .charts-section h2 { font-size: 18px; color: #2c3e50; margin-bottom: 12px; }
  .chart-card { background: white; border-radius: 12px; padding: 16px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 16px; }
  .chart-card h3 { font-size: 15px; color: #2c3e50; margin-bottom: 10px; }
  .chart-card img { width: 100%; border-radius: 6px; }

  /* ê²½ê³ ë¬¸ */
  .disclaimer { font-size: 11px; color: #aaa; text-align: center; margin-top: 24px; }
</style>
</head>
<body>
<div class="container">

  <!-- í—¤ë” -->
  <div class="header">
    <h1>ğŸ“Š ì½”ìŠ¤ë‹¥ ì„¸ë ¥ ë§¤ì§‘ ê°ì§€ ë¦¬í¬íŠ¸</h1>
    <div class="meta">
      ìŠ¤ìº”ì¼: <strong>{{ scan_date }}</strong> &nbsp;|&nbsp;
      ìƒì„±: {{ generated_at }} &nbsp;|&nbsp;
      ê°ì§€ ì¢…ëª©: <strong>{{ total_count }}</strong>ê°œ
    </div>
  </div>

  <!-- ìš”ì•½ ì¹´ë“œ -->
  <div class="summary">
    <div class="card">
      <div class="num">{{ total_count }}</div>
      <div class="label">ê°ì§€ ì¢…ëª© ìˆ˜</div>
    </div>
    <div class="card">
      <div class="num">
        {% if rows %}{{ rows[0].total_score }}{% else %}â€“{% endif %}
      </div>
      <div class="label">ìµœê³  ì ìˆ˜</div>
    </div>
    <div class="card">
      <div class="num">
        {% if rows %}
          {{ (rows | map(attribute='total_score') | list | sum / rows | length) | round(1) }}
        {% else %}â€“{% endif %}
      </div>
      <div class="label">í‰ê·  ì ìˆ˜</div>
    </div>
    <div class="card">
      <div class="num">
        {% set bio = rows | selectattr('sector','equalto','ë°”ì´ì˜¤') | list | length %}
        {{ bio }}
      </div>
      <div class="label">ë°”ì´ì˜¤ ì¢…ëª©</div>
    </div>
  </div>

  <!-- ë©”ì¸ í…Œì´ë¸” -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>ìˆœìœ„</th><th>ì½”ë“œ</th><th>ì¢…ëª©ëª…</th><th>ì´ì </th>
          <th>ì„¹í„°</th><th>ì‹œì´(ì–µ)</th><th>í˜„ì¬ê°€</th>
          <th>OBVë‹¤ì´ë²„</th><th>ê±°ë˜ëŸ‰ë¹„ëŒ€ì¹­</th><th>ë°•ìŠ¤ê¶Œ</th>
          <th>MAì •ë°°ì—´</th><th>ê¸°ê´€ë§¤ìˆ˜</th><th>DART</th>
        </tr>
      </thead>
      <tbody>
      {% for row in rows %}
      {% set score = row.total_score %}
      <tr>
        <td>
          {% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ
          {% elif loop.index == 3 %}ğŸ¥‰{% else %}{{ loop.index }}{% endif %}
        </td>
        <td><strong>{{ row.ticker }}</strong></td>
        <td style="text-align:left">{{ row.name }}</td>
        <td>
          <span class="{{ 'score-high' if score >= 75 else ('score-mid' if score >= 60 else 'score-low') }}">
            {{ score }}
          </span>
        </td>
        <td>
          {% set s = row.sector %}
          <span class="badge {{ 'badge-bio' if s=='ë°”ì´ì˜¤' else ('badge-robot' if s=='ë¡œë´‡' else ('badge-ai' if s=='AI' else ('badge-bat' if s=='2ì°¨ì „ì§€' else 'badge-etc'))) }}">
            {{ s }}
          </span>
        </td>
        <td>{{ row['market_cap_ì–µ'] }}</td>
        <td>{{ "{:,}".format(row.close) }}ì›</td>
        <td>{{ row.signals.get('obv_divergence', 'â€“') }}</td>
        <td>{{ row.signals.get('volume_asymmetry', 'â€“') }}</td>
        <td>{{ row.signals.get('box_range', 'â€“') }}</td>
        <td>{{ row.signals.get('ma_alignment', 'â€“') }}</td>
        <td>{{ row.signals.get('institutional_buying', 'â€“') }}</td>
        <td>{{ row.signals.get('dart_signal', 'â€“') }}</td>
      </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
  {% if chart_files %}
  <div class="charts-section">
    <h2>ğŸ“ˆ ìƒìœ„ ì¢…ëª© ë¶„ì„ ì°¨íŠ¸ (60ì¼)</h2>
    {% for row in rows %}
      {% if row.ticker in chart_files %}
      <div class="chart-card">
        <h3>[{{ row.ticker }}] {{ row.name }} &nbsp; ì´ì  {{ row.total_score }}ì  | {{ row.sector }}</h3>
        <img src="{{ chart_files[row.ticker] }}" alt="{{ row.name }} 60ì¼ ì°¨íŠ¸">
      </div>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}

  <p class="disclaimer">
    âš  ë³¸ ë¦¬í¬íŠ¸ëŠ” ì•Œê³ ë¦¬ì¦˜ ê¸°ë°˜ íˆ¬ì ì°¸ê³ ìš©ì…ë‹ˆë‹¤.
    ì‹¤ì œ íˆ¬ì ì†ìµì— ëŒ€í•œ ì±…ì„ì€ ë³¸ì¸ì—ê²Œ ìˆìœ¼ë©°, ì¢…ëª© ì¶”ì²œì´ ì•„ë‹™ë‹ˆë‹¤.
  </p>
</div>
</body>
</html>
